schema {
  query: Query
  mutation: Mutation
}

scalar JsonData
scalar NumberReal

#########
## @Query

type Query {
  # api:status
  status: JsonData

  # cache:redis
  cacheRedisGetCacheByKey(cache_key: String!): JsonData!

  # collections
  collectionsDocsByTopic(topic: String!, config: JsonData): JsonData!

  # aws-upload
  awsUploadPresignedUrl(filename: String!, contentType: String!, key: String): JsonData!
  awsUploadListObjects(prefix: String): JsonData!
  awsUploadDownloadUrl(key: String!, forceDownload: Boolean): JsonData!
  awsUploadObjectMetadata(key: String!): JsonData!
}

############
## @Mutation

type Mutation {
  # cache:redis
  cacheRedisCommit(
    cache_key: String!
    patch: JsonData
    merge: Boolean
  ): JsonData!
  # batch remove paths for 'cache_key'
  cacheRedisDropPathsAtKey(cache_key: String!, paths: [String!]!): JsonData!

  # messaging
  cloudMessagingPing(payload: JsonData): JsonData!

  # collections:docs
  collectionsDocsUpsert(topic: String!, patches: [JsonData!]!): JsonData!
  collectionsDocsDrop(topic: String!, ids: [ID!]!): JsonData!

  # mail
  mailSendMessage(
    to: String!
    subject: String!
    template: String!
    context: JsonData
  ): JsonData!

  # messaging:viber
  # https://developers.viber.com/docs/tools/channels-post-api/
  viberChannelSetupSetWebhook(
    url: String!
    auth_token: String!
    is_global: Boolean
  ): JsonData!
  viberChannelSetupChannelsDrop(channels: [String!]): JsonData!
  viberSendTextMessage(payload: JsonData!): JsonData!
  viberSendPictureMessage(payload: JsonData!): JsonData!

  # aws-upload
  awsUploadDeleteObject(key: String!): JsonData!
  awsUploadDeleteObjectsAllUnderPrefix(prefix: String): JsonData!
}
